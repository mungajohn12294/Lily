<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>For My Beautiful Lilian ğŸ’• - A Love Journey</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
@import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Roboto:wght@300;400;700&family=Pacifico&display=swap');

:root {
  --pink: #ff61a6;
  --light-pink: #ff9cd8;
  --purple: #302b63;
  --dark: #0f0c29;
  --gold: #ffd700;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: linear-gradient(135deg, var(--dark), var(--purple), #24243e);
  color: #fff;
  overflow-x: hidden;
  font-family: 'Roboto', sans-serif;
  min-height: 100vh;
  position: relative;
}

.container {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  text-align: center;
  padding: 20px;
  position: relative;
  z-index: 2;
}

/* ===== HEADER ===== */
.header {
  margin-bottom: 40px;
  max-width: 800px;
}

.header h1 {
  font-family: 'Dancing Script', cursive;
  font-size: 4rem;
  background: linear-gradient(to right, #ff9cee, var(--pink), var(--light-pink));
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  margin-bottom: 15px;
  text-shadow: 0 0 30px rgba(255, 97, 166, 0.4);
  animation: glow 3s infinite alternate;
}

@keyframes glow {
  0% { text-shadow: 0 0 20px rgba(255, 97, 166, 0.4); }
  100% { text-shadow: 0 0 30px rgba(255, 156, 216, 0.8), 0 0 40px rgba(255, 156, 216, 0.6); }
}

.header p {
  font-size: 1.3rem;
  opacity: 0.9;
  max-width: 600px;
  line-height: 1.6;
  margin: 0 auto;
  color: #ffd1e8;
}

/* ===== TYPING EFFECT ===== */
.typing-text {
  font-size: 1.8rem;
  line-height: 2.5rem;
  max-width: 700px;
  margin: 40px auto;
  min-height: 180px;
  padding: 25px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 20px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
  font-family: 'Pacifico', cursive;
}

/* ===== BUTTONS ===== */
.btn {
  padding: 18px 45px;
  background: linear-gradient(135deg, var(--pink), var(--light-pink), #ff9cee);
  border: none;
  border-radius: 50px;
  color: white;
  font-size: 1.3rem;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.4s ease;
  box-shadow: 0 5px 25px rgba(255, 97, 166, 0.5);
  position: relative;
  overflow: hidden;
  z-index: 1;
  margin: 15px;
  font-family: 'Roboto', sans-serif;
}

.btn:hover {
  transform: translateY(-5px) scale(1.05);
  box-shadow: 0 15px 35px rgba(255, 97, 166, 0.8);
}

.btn:after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, var(--light-pink), var(--pink));
  z-index: -1;
  transition: opacity 0.4s ease;
  opacity: 0;
}

.btn:hover:after {
  opacity: 1;
}

.btn-small {
  padding: 10px 20px;
  font-size: 1rem;
}

/* ===== QUESTION CARDS ===== */
.question-card {
  background: rgba(255, 255, 255, 0.08);
  border: 2px solid rgba(255, 255, 255, 0.15);
  border-radius: 20px;
  padding: 30px;
  margin: 25px 0;
  width: 90%;
  max-width: 600px;
  backdrop-filter: blur(15px);
  display: none;
  flex-direction: column;
  align-items: center;
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
  transform: translateY(20px);
  opacity: 0;
  transition: all 0.5s ease;
}

.question-card.active {
  transform: translateY(0);
  opacity: 1;
}

.question-text {
  font-size: 1.6rem;
  margin-bottom: 25px;
  color: #ffd1e8;
  font-weight: 600;
  line-height: 1.4;
}

.question-card input, .question-card textarea {
  padding: 15px 20px;
  margin: 15px 0;
  border-radius: 15px;
  border: 2px solid rgba(255, 97, 166, 0.3);
  font-size: 1.1rem;
  width: 90%;
  max-width: 400px;
  background: rgba(0, 0, 0, 0.2);
  color: white;
  transition: all 0.3s ease;
  font-family: 'Roboto', sans-serif;
}

.question-card input:focus, .question-card textarea:focus {
  outline: none;
  border-color: var(--pink);
  box-shadow: 0 0 15px rgba(255, 97, 166, 0.5);
}

.question-card input::placeholder, .question-card textarea::placeholder {
  color: rgba(255, 255, 255, 0.6);
}

.answer-buttons {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 15px;
  margin-top: 20px;
}

.answer-btn {
  padding: 12px 25px;
  background: rgba(255, 97, 166, 0.2);
  border: 2px solid var(--pink);
  border-radius: 50px;
  color: white;
  font-size: 1.1rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.answer-btn:hover {
  background: var(--pink);
  transform: scale(1.05);
}

/* ===== FINAL MESSAGE ===== */
.final-message {
  font-size: 2rem;
  margin: 40px 0;
  line-height: 2.5rem;
  display: none;
  padding: 30px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 20px;
  max-width: 700px;
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
}

.final-message .signature {
  font-family: 'Dancing Script', cursive;
  font-size: 2.8rem;
  margin-top: 30px;
  color: var(--light-pink);
}

/* ===== PROGRESS BAR ===== */
.progress-container {
  width: 90%;
  max-width: 600px;
  height: 10px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
  margin: 30px 0;
  overflow: hidden;
  display: none;
}

.progress-bar {
  height: 100%;
  background: linear-gradient(to right, var(--pink), var(--light-pink));
  width: 0%;
  transition: width 0.5s ease;
  border-radius: 10px;
}

/* ===== MAIN MENU ===== */
.main-menu {
  display: none;
  max-width: 1000px;
  margin: 0 auto;
}

.menu-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-top: 40px;
}

.menu-item {
  background: rgba(255, 255, 255, 0.08);
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-radius: 20px;
  padding: 25px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  min-height: 180px;
  justify-content: center;
  backdrop-filter: blur(10px);
}

.menu-item:hover {
  transform: translateY(-10px);
  background: rgba(255, 255, 255, 0.12);
  border-color: var(--pink);
  box-shadow: 0 15px 30px rgba(255, 97, 166, 0.3);
}

.menu-item i {
  font-size: 2.5rem;
  margin-bottom: 15px;
  color: var(--light-pink);
}

.menu-item h3 {
  font-size: 1.4rem;
  margin-bottom: 10px;
  color: #ffd1e8;
}

.menu-item p {
  font-size: 0.95rem;
  opacity: 0.8;
  line-height: 1.4;
}

/* ===== FEATURE SECTIONS ===== */
.feature-section {
  display: none;
  max-width: 1000px;
  margin: 0 auto;
  width: 100%;
}

.back-btn {
  position: fixed;
  top: 20px;
  left: 20px;
  background: rgba(255, 97, 166, 0.8);
  color: white;
  border: none;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  font-size: 1.5rem;
  cursor: pointer;
  z-index: 1000;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  transition: all 0.3s ease;
}

.back-btn:hover {
  background: var(--pink);
  transform: scale(1.1);
}

/* Love Timeline */
.timeline-container {
  position: relative;
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
}

.timeline {
  position: relative;
  margin: 50px 0;
}

.timeline:before {
  content: '';
  position: absolute;
  left: 50%;
  top: 0;
  bottom: 0;
  width: 4px;
  background: linear-gradient(to bottom, var(--pink), var(--light-pink));
  transform: translateX(-50%);
}

.timeline-item {
  margin: 40px 0;
  position: relative;
  width: 50%;
  padding: 20px;
}

.timeline-item:nth-child(odd) {
  left: 0;
}

.timeline-item:nth-child(even) {
  left: 50%;
}

.timeline-content {
  background: rgba(255, 255, 255, 0.08);
  border-radius: 15px;
  padding: 20px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  position: relative;
}

.timeline-content:before {
  content: '';
  position: absolute;
  top: 20px;
  width: 20px;
  height: 20px;
  background: var(--pink);
  border-radius: 50%;
}

.timeline-item:nth-child(odd) .timeline-content:before {
  right: -30px;
}

.timeline-item:nth-child(even) .timeline-content:before {
  left: -30px;
}

.timeline-date {
  font-weight: bold;
  color: var(--light-pink);
  margin-bottom: 10px;
  font-size: 1.2rem;
}

/* Love Map */
#loveMap {
  height: 400px;
  width: 100%;
  border-radius: 20px;
  margin: 20px 0;
  border: 2px solid rgba(255, 255, 255, 0.1);
}

.map-marker {
  background: var(--pink);
  color: white;
  padding: 5px 10px;
  border-radius: 10px;
  font-weight: bold;
}

/* Virtual Gift Box */
.gift-box-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin: 40px 0;
}

.gift-box {
  width: 200px;
  height: 200px;
  position: relative;
  cursor: pointer;
  transform-style: preserve-3d;
  transition: transform 0.5s;
}

.gift-box:hover {
  transform: scale(1.05);
}

.box {
  width: 100%;
  height: 100%;
  background: linear-gradient(45deg, var(--pink), var(--light-pink));
  position: absolute;
  border-radius: 10px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
}

.lid {
  width: 100%;
  height: 40px;
  background: linear-gradient(45deg, #ff4081, var(--pink));
  position: absolute;
  top: -20px;
  border-radius: 10px 10px 0 0;
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
}

.ribbon {
  position: absolute;
  width: 100%;
  height: 20px;
  background: var(--gold);
  top: 50%;
  left: 0;
  transform: translateY(-50%);
}

.ribbon:before, .ribbon:after {
  content: '';
  position: absolute;
  width: 30px;
  height: 30px;
  background: var(--gold);
  border-radius: 50%;
  top: -5px;
}

.ribbon:before {
  left: 50px;
}

.ribbon:after {
  right: 50px;
}

.gift-content {
  display: none;
  margin-top: 40px;
  width: 100%;
}

.gift-items {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.gift-item {
  background: rgba(255, 255, 255, 0.08);
  border-radius: 15px;
  padding: 20px;
  cursor: pointer;
  transition: all 0.3s ease;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.gift-item:hover {
  transform: translateY(-5px);
  background: rgba(255, 255, 255, 0.12);
  border-color: var(--pink);
}

.gift-item i {
  font-size: 2.5rem;
  color: var(--light-pink);
  margin-bottom: 10px;
}

/* Love Quiz */
.quiz-container {
  max-width: 600px;
  margin: 0 auto;
}

.quiz-question {
  font-size: 1.5rem;
  margin-bottom: 30px;
  color: #ffd1e8;
}

.quiz-options {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.quiz-option {
  background: rgba(255, 255, 255, 0.08);
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-radius: 15px;
  padding: 15px;
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: left;
  font-size: 1.1rem;
}

.quiz-option:hover {
  background: rgba(255, 97, 166, 0.2);
  border-color: var(--pink);
}

.quiz-option.selected {
  background: rgba(255, 97, 166, 0.3);
  border-color: var(--pink);
  box-shadow: 0 0 15px rgba(255, 97, 166, 0.5);
}

/* Photo Album */
.album-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 20px;
  margin-top: 30px;
}

.memory-card {
  background: rgba(255, 255, 255, 0.08);
  border-radius: 15px;
  padding: 20px;
  min-height: 200px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: all 0.3s ease;
  cursor: pointer;
}

.memory-card:hover {
  transform: translateY(-5px);
  background: rgba(255, 255, 255, 0.12);
  border-color: var(--pink);
}

.memory-emoji {
  font-size: 3rem;
  margin-bottom: 15px;
}

/* Bucket List */
.bucket-list-container {
  max-width: 600px;
  margin: 0 auto;
}

.bucket-item {
  background: rgba(255, 255, 255, 0.08);
  border-radius: 15px;
  padding: 15px;
  margin: 15px 0;
  display: flex;
  align-items: center;
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: all 0.3s ease;
}

.bucket-item:hover {
  background: rgba(255, 255, 255, 0.12);
  border-color: var(--pink);
}

.bucket-item input {
  margin-right: 15px;
  transform: scale(1.5);
}

.bucket-item label {
  font-size: 1.2rem;
  cursor: pointer;
  flex-grow: 1;
  text-align: left;
}

.bucket-item.completed label {
  text-decoration: line-through;
  color: var(--light-pink);
}

/* Love Meter */
.love-meter-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin: 40px 0;
}

.meter {
  width: 200px;
  height: 200px;
  position: relative;
  margin-bottom: 30px;
}

.meter-circle {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background: conic-gradient(var(--pink) 0%, var(--light-pink) 100%);
  position: relative;
  overflow: hidden;
}

.meter-inner {
  position: absolute;
  width: 80%;
  height: 80%;
  background: var(--dark);
  border-radius: 50%;
  top: 10%;
  left: 10%;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 2.5rem;
  color: var(--light-pink);
}

.compatibility-result {
  font-size: 1.5rem;
  margin-top: 20px;
  color: #ffd1e8;
}

/* Love Tree */
.tree-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin: 40px 0;
}

.tree {
  position: relative;
  width: 200px;
  height: 300px;
}

.trunk {
  width: 40px;
  height: 120px;
  background: #8B4513;
  position: absolute;
  bottom: 0;
  left: 80px;
  border-radius: 10px;
}

.canopy {
  width: 200px;
  height: 200px;
  background: radial-gradient(circle at 50% 0%, #228B22, #006400);
  border-radius: 100px 100px 100px 100px / 120px 120px 80px 80px;
  position: absolute;
  top: 0;
}

.leaf {
  position: absolute;
  color: #228B22;
  font-size: 24px;
}

/* Candle Room */
.candle-room {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 30px;
  margin: 40px 0;
}

.candle {
  width: 40px;
  height: 120px;
  position: relative;
  cursor: pointer;
}

.candle-body {
  width: 100%;
  height: 100%;
  background: linear-gradient(to bottom, white, #f0f0f0);
  border-radius: 5px;
  position: absolute;
}

.wick {
  width: 4px;
  height: 15px;
  background: #333;
  position: absolute;
  top: -15px;
  left: 18px;
}

.flame {
  width: 20px;
  height: 40px;
  background: linear-gradient(to bottom, #ffaa00, #ff5500);
  border-radius: 50% 50% 20% 20%;
  position: absolute;
  top: -55px;
  left: 10px;
  opacity: 0;
  animation: flicker 0.5s infinite alternate;
}

@keyframes flicker {
  0% { transform: scale(1); opacity: 0.8; }
  100% { transform: scale(1.1); opacity: 1; }
}

.candle.lit .flame {
  opacity: 1;
}

/* Fortune Cookie */
.fortune-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin: 40px 0;
}

.fortune-cookie {
  width: 200px;
  height: 100px;
  background: linear-gradient(to bottom, #f4a460, #d2691e);
  border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
  position: relative;
  cursor: pointer;
  transition: transform 0.5s;
}

.fortune-cookie:hover {
  transform: scale(1.05);
}

.fortune-paper {
  position: absolute;
  width: 180px;
  height: 60px;
  background: white;
  top: 20px;
  left: 10px;
  border-radius: 5px;
  padding: 10px;
  display: none;
  color: #333;
  font-style: italic;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

/* Time Capsule */
.time-capsule-container {
  max-width: 600px;
  margin: 0 auto;
}

.time-capsule-input {
  width: 100%;
  margin: 15px 0;
}

.capsule-date {
  font-size: 1.2rem;
  color: var(--light-pink);
  margin: 20px 0;
}

/* Love Codes */
.code-input {
  font-size: 2rem;
  letter-spacing: 10px;
  text-align: center;
  background: rgba(0, 0, 0, 0.3);
  border: 2px solid var(--pink);
  border-radius: 10px;
  padding: 20px;
  margin: 20px 0;
  width: 300px;
  color: white;
}

.code-hint {
  margin-top: 20px;
  font-style: italic;
  color: var(--light-pink);
}

/* Floating Elements */
.heart {
  position: absolute;
  color: var(--pink);
  font-size: 24px;
  animation: floatUp 6s linear infinite;
  opacity: 0;
  z-index: 1;
  pointer-events: none;
}

@keyframes floatUp {
  0% {
    transform: translateY(100vh) rotate(0deg) scale(0.5);
    opacity: 0;
  }
  10% {
    opacity: 0.8;
  }
  90% {
    opacity: 0.6;
  }
  100% {
    transform: translateY(-100px) rotate(360deg) scale(1.2);
    opacity: 0;
  }
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.pulse {
  animation: pulse 2s infinite;
}

.background-hearts {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 0;
}

/* Music Player */
.music-player {
  position: fixed;
  bottom: 30px;
  right: 30px;
  z-index: 1000;
}

.music-btn {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: rgba(255, 97, 166, 0.8);
  border: none;
  color: white;
  font-size: 1.8rem;
  cursor: pointer;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  transition: all 0.3s ease;
}

.music-btn:hover {
  background: var(--pink);
  transform: scale(1.1);
}

/* Love Counter */
.love-counter {
  position: fixed;
  top: 30px;
  left: 30px;
  background: rgba(255, 255, 255, 0.1);
  padding: 15px 25px;
  border-radius: 15px;
  backdrop-filter: blur(10px);
  font-size: 1.2rem;
  display: none;
  z-index: 1000;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.love-counter i {
  color: var(--pink);
  margin-right: 10px;
}

/* Hidden Love Messages */
.hidden-love {
  display: none;
  position: fixed;
  background: rgba(255, 255, 255, 0.95);
  color: var(--purple);
  padding: 20px;
  border-radius: 15px;
  max-width: 300px;
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
  z-index: 1000;
  font-size: 1.1rem;
  line-height: 1.4;
}

.secret-btn {
  position: fixed;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1);
  border: 2px solid rgba(255, 255, 255, 0.3);
  color: rgba(255, 255, 255, 0.5);
  cursor: pointer;
  transition: all 0.3s ease;
  z-index: 100;
}

.secret-btn:hover {
  background: rgba(255, 97, 166, 0.2);
  color: white;
  border-color: var(--pink);
}

/* Section Title */
.section-title {
  font-family: 'Dancing Script', cursive;
  font-size: 3rem;
  color: var(--light-pink);
  margin: 30px 0;
  text-align: center;
}
</style>
</head>
<body>

<div class="background-hearts" id="backgroundHearts"></div>

<div class="love-counter" id="loveCounter">
  <i class="fas fa-heart"></i> <span id="loveScore">100</span> Love Points
</div>

<!-- Main Container for Initial Experience -->
<div class="container" id="mainContainer">
  <div class="header">
    <h1>For My Beautiful Lilian ğŸ’–</h1>
    <p>A journey of our friendship, laughter, and the special bond we share</p>
  </div>
  
  <div class="typing-text" id="typing"></div>
  
  <button class="btn pulse" id="startBtn">
    <i class="fas fa-gift"></i> Begin Our Special Journey ğŸ’
  </button>
  
  <div class="progress-container" id="progressContainer">
    <div class="progress-bar" id="progressBar"></div>
  </div>

  <!-- Question Cards -->
  <div class="question-card" id="q1">
    <div class="question-text">How did we first become friends? What was your first impression of me? ğŸ˜Š</div>
    <input type="text" id="a1" placeholder="Tell me everything you remember...">
    <button class="btn" onclick="nextQuestion(1)">Next ğŸ’•</button>
  </div>

  <div class="question-card" id="q2">
    <div class="question-text">What's your favorite thing about our friendship? What makes it special? ğŸ’­</div>
    <input type="text" id="a2" placeholder="I'd love to know...">
    <button class="btn" onclick="nextQuestion(2)">Continue ğŸŒ¸</button>
  </div>

  <div class="question-card" id="q3">
    <div class="question-text">What's your absolute favorite memory we've shared together? ğŸŒŸ</div>
    <input type="text" id="a3" placeholder="That one time when...">
    <button class="btn" onclick="nextQuestion(3)">Next ğŸŒˆ</button>
  </div>

  <div class="question-card" id="q4">
    <div class="question-text">What's something you've always wanted to tell me but never had the chance? ğŸ¤—</div>
    <input type="text" id="a4" placeholder="Your secret thoughts...">
    <button class="btn" onclick="nextQuestion(4)">Next ğŸ’«</button>
  </div>

  <div class="question-card" id="q5">
    <div class="question-text">How do I make you feel when you're having a bad day? ğŸ¥º</div>
    <div class="answer-buttons">
      <button class="answer-btn" onclick="submitAnswer(5, 'You make everything better âœ¨')">You make everything better âœ¨</button>
      <button class="answer-btn" onclick="submitAnswer(5, 'Instantly happier ğŸ’–')">Instantly happier ğŸ’–</button>
      <button class="answer-btn" onclick="submitAnswer(5, 'Loved and understood ğŸŒ¸')">Loved and understood ğŸŒ¸</button>
    </div>
  </div>

  <div class="question-card" id="q6">
    <div class="question-text">What's something you wish we could do together in the future? ğŸš€</div>
    <input type="text" id="a6" placeholder="Dreaming of...">
    <button class="btn" onclick="nextQuestion(6)">Next ğŸŒ </button>
  </div>

  <div class="question-card" id="q7">
    <div class="question-text">What song reminds you of our friendship? ğŸµ</div>
    <input type="text" id="a7" placeholder="Our theme song...">
    <button class="btn" onclick="nextQuestion(7)">Next ğŸ¶</button>
  </div>

  <div class="question-card" id="q8">
    <div class="question-text">What's the most thoughtful thing I've ever done for you? ğŸ’</div>
    <input type="text" id="a8" placeholder="That meant so much...">
    <button class="btn" onclick="nextQuestion(8)">Next ğŸŒº</button>
  </div>

  <div class="question-card" id="q9">
    <div class="question-text">Do I make you smile even on your toughest days? ğŸ˜Œ</div>
    <div class="answer-buttons">
      <button class="answer-btn" onclick="submitAnswer(9, 'Always and forever ğŸ’•')">Always and forever ğŸ’•</button>
      <button class="answer-btn" onclick="submitAnswer(9, 'You have magic smile powers âœ¨')">You have magic smile powers âœ¨</button>
      <button class="answer-btn" onclick="submitAnswer(9, 'Your smile is contagious! ğŸ˜„')">Your smile is contagious! ğŸ˜„</button>
    </div>
  </div>

  <div class="question-card" id="q10">
    <div class="question-text">Final question: What does our friendship mean to you? ğŸ’–</div>
    <textarea id="a10" placeholder="Pour your heart out..." rows="4"></textarea>
    <button class="btn" onclick="nextQuestion(10)">See Your Surprise! ğŸ</button>
  </div>

  <div class="final-message" id="final">
    <p>My Dearest Lilian,</p><br>
    
    <p>Every moment with you is a treasure I hold close to my heart. ğŸ’</p>
    <p>Your laughter is my favorite melody,</p>
    <p>Your friendship my greatest blessing.</p><br>
    
    <p>Through all seasons of life,</p>
    <p>I promise to always be there for you -</p>
    <p>To celebrate your joys, comfort your sorrows,</p>
    <p>And cherish every single memory we create. âœ¨</p><br>
    
    <p>You are more special than words could ever express,</p>
    <p>And I'm endlessly grateful for you.</p><br>
    
    <p>Merry Christmas my beautiful friend ğŸ„</p>
    <p>May our friendship shine brighter with each passing year. ğŸ’«</p><br>
    
    <div class="signature">Forever Yours ğŸ’–</div>
    
    <div style="margin-top: 40px;">
      <button class="btn pulse" onclick="sendHug()">
        <i class="fas fa-heart"></i> Send You All My Love ğŸ’Œ
      </button>
      <button class="btn" onclick="showMainMenu()" style="margin-left: 20px;">
        <i class="fas fa-star"></i> Explore More Love Features ğŸŒŸ
      </button>
    </div>
  </div>
</div>

<!-- ===== MAIN MENU ===== -->
<div class="container main-menu" id="mainMenu">
  <button class="back-btn" onclick="backToFinal()">
    <i class="fas fa-arrow-left"></i>
  </button>
  
  <h2 class="section-title">Our Love Garden ğŸŒ¸</h2>
  <p style="margin-bottom: 30px; font-size: 1.2rem; max-width: 600px;">Explore all the special features I created just for you, my darling Lilian ğŸ’–</p>
  
  <div class="menu-grid">
    <div class="menu-item" onclick="showFeature('timeline')">
      <i class="fas fa-history"></i>
      <h3>Love Timeline</h3>
      <p>Relive our beautiful journey together ğŸ“…</p>
    </div>
    
    <div class="menu-item" onclick="showFeature('loveMap')">
      <i class="fas fa-map-marker-alt"></i>
      <h3>Our Special Places</h3>
      <p>Map of memories that mean everything ğŸŒ</p>
    </div>
    
    <div class="menu-item" onclick="showFeature('giftBox')">
      <i class="fas fa-gift"></i>
      <h3>Virtual Gift Box</h3>
      <p>Open your special presents ğŸ</p>
    </div>
    
    <div class="menu-item" onclick="showFeature('loveQuiz')">
      <i class="fas fa-question-circle"></i>
      <h3>Love Quiz</h3>
      <p>How well do you know me? ğŸ˜Š</p>
    </div>
    
    <div class="menu-item" onclick="showFeature('loveMeter')">
      <i class="fas fa-heartbeat"></i>
      <h3>Love Meter</h3>
      <p>Check our compatibility ğŸ’˜</p>
    </div>
    
    <div class="menu-item" onclick="showFeature('photoAlbum')">
      <i class="fas fa-images"></i>
      <h3>Memory Album</h3>
      <p>Our beautiful moments ğŸ“¸</p>
    </div>
    
    <div class="menu-item" onclick="showFeature('bucketList')">
      <i class="fas fa-list-check"></i>
      <h3>Future Bucket List</h3>
      <p>Dreams we'll achieve together âœ¨</p>
    </div>
    
    <div class="menu-item" onclick="showFeature('loveTree')">
      <i class="fas fa-tree"></i>
      <h3>Love Tree</h3>
      <p>Watch our love grow ğŸŒ³</p>
    </div>
    
    <div class="menu-item" onclick="showFeature('loveCodes')">
      <i class="fas fa-key"></i>
      <h3>Secret Love Codes</h3>
      <p>Discover hidden messages ğŸ”</p>
    </div>
    
    <div class="menu-item" onclick="showFeature('candleRoom')">
      <i class="fas fa-fire"></i>
      <h3>Candle Room</h3>
      <p>Light candles for our memories ğŸ•¯ï¸</p>
    </div>
    
    <div class="menu-item" onclick="showFeature('fortuneCookie')">
      <i class="fas fa-cookie-bite"></i>
      <h3>Fortune Cookies</h3>
      <p>Your daily love fortunes ğŸ¥ </p>
    </div>
    
    <div class="menu-item" onclick="showFeature('timeCapsule')">
      <i class="fas fa-time"></i>
      <h3>Time Capsule</h3>
      <p>Messages to our future selves â³</p>
    </div>
  </div>
</div>

<!-- ===== FEATURE SECTIONS ===== -->

<!-- Love Timeline -->
<div class="container feature-section" id="timelineSection">
  <button class="back-btn" onclick="backToMenu()">
    <i class="fas fa-arrow-left"></i>
  </button>
  
  <h2 class="section-title">Our Love Timeline ğŸŒˆ</h2>
  <p style="margin-bottom: 30px;">Every moment with you is written in my heart forever ğŸ’–</p>
  
  <div class="timeline-container">
    <div class="timeline">
      <div class="timeline-item">
        <div class="timeline-content">
          <div class="timeline-date">The Beginning ğŸ’«</div>
          <h3>When We First Met</h3>
          <p>That magical day when our paths crossed and my life changed forever...</p>
          <button class="btn-small" onclick="addMemory('firstMeet')">Add Your Memory</button>
        </div>
      </div>
      
      <div class="timeline-item">
        <div class="timeline-content">
          <div class="timeline-date">First Laugh Together ğŸ˜„</div>
          <h3>That Joke You Told</h3>
          <p>When you made me laugh so hard I cried - I knew then you were special.</p>
          <button class="btn-small" onclick="addMemory('firstLaugh')">Share Your Version</button>
        </div>
      </div>
      
      <div class="timeline-item">
        <div class="timeline-content">
          <div class="timeline-date">Late Night Talks ğŸŒ™</div>
          <h3>Our First Deep Conversation</h3>
          <p>Sharing dreams and fears under the stars... those nights bonded us forever.</p>
          <button class="btn-small" onclick="addMemory('lateNight')">Add Your Thoughts</button>
        </div>
      </div>
      
      <div class="timeline-item">
        <div class="timeline-content">
          <div class="timeline-date">Our First Adventure ğŸš€</div>
          <h3>That Day We Explored Together</h3>
          <p>Every adventure with you feels like discovering a new world.</p>
          <button class="btn-small" onclick="addMemory('adventure')">Describe Our Adventure</button>
        </div>
      </div>
      
      <div class="timeline-item">
        <div class="timeline-content">
          <div class="timeline-date">Today & Forever ğŸ’–</div>
          <h3>This Beautiful Present</h3>
          <p>Every day with you is a gift I cherish. Here's to infinite more memories together.</p>
          <button class="btn-small" onclick="addMemory('present')">Write Our Future</button>
        </div>
      </div>
    </div>
  </div>
  
  <div style="margin-top: 40px;">
    <h3>Add Your Own Timeline Entry</h3>
    <input type="text" id="timelineDate" placeholder="Special Date (e.g., Our First Christmas)" style="width: 300px; margin: 10px;">
    <textarea id="timelineMemory" placeholder="Describe this special memory..." rows="3" style="width: 300px; margin: 10px;"></textarea>
    <button class="btn" onclick="saveTimelineEntry()">Save to Our Timeline ğŸ’¾</button>
  </div>
</div>

<!-- Love Map -->
<div class="container feature-section" id="loveMapSection">
  <button class="back-btn" onclick="backToMenu()">
    <i class="fas fa-arrow-left"></i>
  </button>
  
  <h2 class="section-title">Our Special Places ğŸŒ</h2>
  <p style="margin-bottom: 30px;">Every place becomes magical when I'm with you ğŸ’«</p>
  
  <div id="loveMap"></div>
  
  <div style="margin-top: 30px; max-width: 600px;">
    <h3>Add a Special Place</h3>
    <input type="text" id="placeName" placeholder="Place Name" style="width: 300px; margin: 10px;">
    <textarea id="placeMemory" placeholder="Why is this place special to us?" rows="3" style="width: 300px; margin: 10px;"></textarea>
    <button class="btn" onclick="addSpecialPlace()">Add to Our Map ğŸ“</button>
  </div>
</div>

<!-- Virtual Gift Box -->
<div class="container feature-section" id="giftBoxSection">
  <button class="back-btn" onclick="backToMenu()">
    <i class="fas fa-arrow-left"></i>
  </button>
  
  <h2 class="section-title">Your Virtual Gift Box ğŸ</h2>
  <p style="margin-bottom: 30px;">Special gifts from my heart to yours ğŸ’</p>
  
  <div class="gift-box-container">
    <div class="gift-box" onclick="openGiftBox()">
      <div class="box">
        <div class="lid"></div>
        <div class="ribbon"></div>
      </div>
    </div>
    <p style="margin-top: 20px; font-size: 1.2rem;">Click the gift box to open! ğŸ€</p>
    
    <div class="gift-content" id="giftContent">
      <h3 style="margin: 30px 0;">Your Special Gifts ğŸ’</h3>
      
      <div class="gift-items">
        <div class="gift-item" onclick="revealGift(1)">
          <i class="fas fa-music"></i>
          <h4>Our Song</h4>
          <p>Click to reveal</p>
        </div>
        
        <div class="gift-item" onclick="revealGift(2)">
          <i class="fas fa-heart"></i>
          <h4>Love Letter</h4>
          <p>From my heart to yours</p>
        </div>
        
        <div class="gift-item" onclick="revealGift(3)">
          <i class="fas fa-star"></i>
          <h4>Promise Stars</h4>
          <p>My promises to you</p>
        </div>
        
        <div class="gift-item" onclick="revealGift(4)">
          <i class="fas fa-gem"></i>
          <h4>Memory Jewel</h4>
          <p>Precious moments</p>
        </div>
        
        <div class="gift-item" onclick="revealGift(5)">
          <i class="fas fa-laugh-beam"></i>
          <h4>Joy Package</h4>
          <p>Endless happiness</p>
        </div>
        
        <div class="gift-item" onclick="revealGift(6)">
          <i class="fas fa-infinity"></i>
          <h4>Forever Bond</h4>
          <p>Unbreakable connection</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Love Quiz -->
<div class="container feature-section" id="loveQuizSection">
  <button class="back-btn" onclick="backToMenu()">
    <i class="fas fa-arrow-left"></i>
  </button>
  
  <h2 class="section-title">How Well Do You Know Me? ğŸ˜Š</h2>
  <p style="margin-bottom: 30px;">Let's see how much you pay attention! ğŸ’­</p>
  
  <div class="quiz-container" id="quizContainer">
    <!-- Quiz questions will be loaded here -->
  </div>
  
  <div id="quizResult" style="display: none; margin-top: 40px;">
    <h3 id="quizScore" style="color: var(--light-pink);"></h3>
    <p id="quizMessage"></p>
    <button class="btn" onclick="restartQuiz()">Try Again ğŸ”„</button>
  </div>
</div>

<!-- Love Meter -->
<div class="container feature-section" id="loveMeterSection">
  <button class="back-btn" onclick="backToMenu()">
    <i class="fas fa-arrow-left"></i>
  </button>
  
  <h2 class="section-title">Our Love Meter ğŸ’˜</h2>
  <p style="margin-bottom: 30px;">Measuring the magic of our connection âœ¨</p>
  
  <div class="love-meter-container">
    <div class="meter">
      <div class="meter-circle" id="meterCircle">
        <div class="meter-inner" id="meterPercent">0%</div>
      </div>
    </div>
    
    <button class="btn" onclick="calculateCompatibility()">Calculate Our Compatibility ğŸ’–</button>
    
    <div id="compatibilityResult" style="display: none; margin-top: 30px;">
      <h3 class="compatibility-result" id="compatibilityText"></h3>
      <p id="compatibilityDescription" style="margin-top: 15px; max-width: 500px;"></p>
    </div>
  </div>
</div>

<!-- Photo Album -->
<div class="container feature-section" id="photoAlbumSection">
  <button class="back-btn" onclick="backToMenu()">
    <i class="fas fa-arrow-left"></i>
  </button>
  
  <h2 class="section-title">Our Memory Album ğŸ“¸</h2>
  <p style="margin-bottom: 30px;">Every memory with you is a treasure I keep in my heart ğŸ’</p>
  
  <div class="album-container" id="albumContainer">
    <!-- Memory cards will be loaded here -->
  </div>
  
  <div style="margin-top: 40px;">
    <h3>Add Your Own Memory</h3>
    <input type="text" id="memoryTitle" placeholder="Memory Title" style="width: 300px; margin: 10px;">
    <textarea id="memoryDescription" placeholder="Describe this beautiful memory..." rows="3" style="width: 300px; margin: 10px;"></textarea>
    <select id="memoryEmoji" style="width: 300px; padding: 10px; margin: 10px; border-radius: 10px; background: rgba(0,0,0,0.3); color: white; border: 2px solid var(--pink);">
      <option value="â¤ï¸">â¤ï¸ Love</option>
      <option value="ğŸ˜„">ğŸ˜„ Laughter</option>
      <option value="ğŸŒŸ">ğŸŒŸ Magical</option>
      <option value="ğŸŒ¸">ğŸŒ¸ Beautiful</option>
      <option value="ğŸ‰">ğŸ‰ Celebration</option>
      <option value="ğŸ¤—">ğŸ¤— Hug</option>
      <option value="ğŸŒˆ">ğŸŒˆ Rainbow</option>
      <option value="âœ¨">âœ¨ Sparkle</option>
    </select>
    <button class="btn" onclick="addMemoryCard()">Add to Our Album ğŸ’¾</button>
  </div>
</div>

<!-- Bucket List -->
<div class="container feature-section" id="bucketListSection">
  <button class="back-btn" onclick="backToMenu()">
    <i class="fas fa-arrow-left"></i>
  </button>
  
  <h2 class="section-title">Our Future Bucket List âœ¨</h2>
  <p style="margin-bottom: 30px;">Dreams we'll achieve together ğŸš€</p>
  
  <div class="bucket-list-container">
    <div class="bucket-item">
      <input type="checkbox" id="bucket1" onchange="toggleBucketItem(1)">
      <label for="bucket1">Watch sunrise together on a beach ğŸŒ…</label>
    </div>
    
    <div class="bucket-item">
      <input type="checkbox" id="bucket2" onchange="toggleBucketItem(2)">
      <label for="bucket2">Take a spontaneous road trip ğŸš—</label>
    </div>
    
    <div class="bucket-item">
      <input type="checkbox" id="bucket3" onchange="toggleBucketItem(3)">
      <label for="bucket3">Stargaze all night âœ¨</label>
    </div>
    
    <div class="bucket-item">
      <input type="checkbox" id="bucket4" onchange="toggleBucketItem(4)">
      <label for="bucket4">Have a picnic in a flower field ğŸŒ¸</label>
    </div>
    
    <div class="bucket-item">
      <input type="checkbox" id="bucket5" onchange="toggleBucketItem(5)">
      <label for="bucket5">Write a song together ğŸµ</label>
    </div>
    
    <div class="bucket-item">
      <input type="checkbox" id="bucket6" onchange="toggleBucketItem(6)">
      <label for="bucket6">Learn to dance together ğŸ’ƒ</label>
    </div>
    
    <div class="bucket-item">
      <input type="checkbox" id="bucket7" onchange="toggleBucketItem(7)">
      <label for="bucket7">Volunteer together for a cause ğŸ¤</label>
    </div>
    
    <div class="bucket-item">
      <input type="checkbox" id="bucket8" onchange="toggleBucketItem(8)">
      <label for="bucket8">Build a time capsule together â³</label>
    </div>
  </div>
  
  <div style="margin-top: 40px;">
    <h3>Add Your Own Bucket List Item</h3>
    <input type="text" id="newBucketItem" placeholder="What do you want us to do together?" style="width: 400px; margin: 10px;">
    <button class="btn" onclick="addBucketItem()">Add to Our List â•</button>
  </div>
</div>

<!-- Love Tree -->
<div class="container feature-section" id="loveTreeSection">
  <button class="back-btn" onclick="backToMenu()">
    <i class="fas fa-arrow-left"></i>
  </button>
  
  <h2 class="section-title">Our Love Tree ğŸŒ³</h2>
  <p style="margin-bottom: 30px">Watch our friendship grow with every memory ğŸŒ±</p>
  
  <div class="tree-container">
    <div class="tree" id="loveTree">
      <div class="canopy"></div>
      <div class="trunk"></div>
    </div>
    
    <p style="margin: 20px 0; font-size: 1.2rem;">Tree Level: <span id="treeLevel">1</span></p>
    
    <button class="btn" onclick="waterTree()">
      <i class="fas fa-tint"></i> Water Our Tree ğŸ’§
    </button>
    
    <p style="margin-top: 20px; max-width: 500px;">Every time you share a memory or answer a question, our tree grows stronger! ğŸŒ¿</p>
  </div>
</div>

<!-- Love Codes -->
<div class="container feature-section" id="loveCodesSection">
  <button class="back-btn" onclick="backToMenu()">
    <i class="fas fa-arrow-left"></i>
  </button>
  
  <h2 class="section-title">Secret Love Codes ğŸ”</h2>
  <p style="margin-bottom: 30px;">Discover hidden messages with special codes ğŸ’Œ</p>
  
  <div style="margin: 30px 0;">
    <input type="text" class="code-input" id="codeInput" maxlength="4" placeholder="____" oninput="checkCode()">
    <p class="code-hint">Hint: Try 143 (I Love You) or your birth month and day</p>
  </div>
  
  <div id="codeMessage" style="display: none; margin-top: 30px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 15px; max-width: 500px;">
    <h3 id="codeTitle" style="color: var(--light-pink);"></h3>
    <p id="codeContent"></p>
  </div>
  
  <div style="margin-top: 40px;">
    <h3>Create Your Own Love Code</h3>
    <input type="text" id="newCode" placeholder="4-digit code" maxlength="4" style="width: 150px; margin: 10px;">
    <input type="text" id="codeMeaning" placeholder="Secret message" style="width: 300px; margin: 10px;">
    <button class="btn" onclick="saveLoveCode()">Save Secret Code ğŸ”’</button>
  </div>
</div>

<!-- Candle Room -->
<div class="container feature-section" id="candleRoomSection">
  <button class="back-btn" onclick="backToMenu()">
    <i class="fas fa-arrow-left"></i>
  </button>
  
  <h2 class="section-title">Our Candle Room ğŸ•¯ï¸</h2>
  <p style="margin-bottom: 30px;">Light candles for our special memories âœ¨</p>
  
  <div class="candle-room" id="candleRoom">
    <!-- Candles will be added here -->
  </div>
  
  <div style="margin-top: 40px;">
    <h3>Light a New Candle</h3>
    <input type="text" id="candleName" placeholder="What memory is this candle for?" style="width: 300px; margin: 10px;">
    <button class="btn" onclick="addCandle()">
      <i class="fas fa-fire"></i> Light a Candle ğŸ”¥
    </button>
  </div>
  
  <p style="margin-top: 30px; max-width: 500px;">Each candle represents a beautiful memory we've shared. Light them to remember and cherish each moment. ğŸ’–</p>
</div>

<!-- Fortune Cookie -->
<div class="container feature-section" id="fortuneCookieSection">
  <button class="back-btn" onclick="backToMenu()">
    <i class="fas fa-arrow-left"></i>
  </button>
  
  <h2 class="section-title">Your Love Fortune ğŸ¥ </h2>
  <p style="margin-bottom: 30px;">Daily messages of love and inspiration ğŸ’«</p>
  
  <div class="fortune-container">
    <div class="fortune-cookie" onclick="openFortune()">
      <div class="fortune-paper" id="fortunePaper"></div>
    </div>
    
    <p style="margin-top: 20px; font-size: 1.2rem;">Click the fortune cookie to open! ğŸ¥ </p>
    
    <div id="fortuneHistory" style="margin-top: 40px; max-width: 500px; display: none;">
      <h3>Your Previous Fortunes</h3>
      <div id="fortuneList"></div>
    </div>
  </div>
</div>

<!-- Time Capsule -->
<div class="container feature-section" id="timeCapsuleSection">
  <button class="back-btn" onclick="backToMenu()">
    <i class="fas fa-arrow-left"></i>
  </button>
  
  <h2 class="section-title">Our Time Capsule â³</h2>
  <p style="margin-bottom: 30px;">Messages to our future selves ğŸ’Œ</p>
  
  <div class="time-capsule-container">
    <div class="capsule-date">To be opened: <span id="openDate">One year from today</span></div>
    
    <div style="margin: 30px 0;">
      <h3>Message to Future Lilian</h3>
      <textarea class="time-capsule-input" id="toFutureLilian" placeholder="What do you want to tell your future self?" rows="4"></textarea>
      
      <h3>Message to Future Us</h3>
      <textarea class="time-capsule-input" id="toFutureUs" placeholder="What do you hope for our friendship?" rows="4"></textarea>
      
      <h3>Predictions for the Future</h3>
      <textarea class="time-capsule-input" id="futurePredictions" placeholder="What do you think we'll be doing in a year?" rows="4"></textarea>
    </div>
    
    <button class="btn" onclick="sealTimeCapsule()">
      <i class="fas fa-lock"></i> Seal Time Capsule ğŸ”’
    </button>
    
    <div id="capsuleSealed" style="display: none; margin-top: 30px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 15px;">
      <h3 style="color: var(--light-pink);">Time Capsule Sealed! ğŸ‰</h3>
      <p>Your messages have been saved and will be available on <span id="capsuleDate"></span>. I'll remind you to open it together! ğŸ’–</p>
    </div>
  </div>
</div>

<!-- Music Player -->
<div class="music-player">
  <button class="music-btn" id="musicBtn" onclick="toggleMusic()">
    <i class="fas fa-music"></i>
  </button>
</div>

<!-- Hidden love messages -->
<div class="hidden-love" id="hiddenMessage1">
  Did you know? Every time you smile, my world gets brighter. âœ¨
</div>
<div class="hidden-love" id="hiddenMessage2">
  You're the best part of my day, every day. ğŸ’–
</div>
<div class="hidden-love" id="hiddenMessage3">
  I treasure every memory with you like precious gems. ğŸ’
</div>

<!-- Secret buttons -->
<button class="secret-btn" style="top: 100px; left: 30px;" onclick="showHiddenMessage(1)">?</button>
<button class="secret-btn" style="bottom: 150px; right: 80px;" onclick="showHiddenMessage(2)">?</button>
<button class="secret-btn" style="top: 200px; right: 50px;" onclick="showHiddenMessage(3)">?</button>

<!-- Libraries -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// ========================
// FIREBASE CONFIGURATION
// ========================
const firebaseConfig = {
  apiKey: "AIzaSyB2mQNeygEwdWFCnHJnw9wlqHWKmXlfe38",
  authDomain: "taptap-377d9.firebaseapp.com",
  databaseURL: "https://taptap-377d9-default-rtdb.firebaseio.com",
  projectId: "taptap-377d9",
  storageBucket: "taptap-377d9.firebasestorage.app",
  messagingSenderId: "146364410143",
  appId: "1:146364410143:web:3ce902bdcaeb954091682a",
  measurementId: "G-LRJ2TK7CDH"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ========================
// GLOBAL VARIABLES
// ========================
let currentQuestion = 0;
const totalQuestions = 10;
let loveScore = 100;
let musicPlaying = false;
let map = null;
let treeLevel = 1;
let treeLeaves = 0;
const backgroundMusic = new Audio('https://assets.mixkit.co/music/preview/mixkit-loving-you-1171.mp3');
backgroundMusic.loop = true;

// Typing effect messages
const messages = [
  "My Dearest Lilian... ğŸ’–",
  "This Christmas, I wanted to give you something special ğŸ",
  "A gift that comes straight from my heart ğŸ’",
  "To celebrate our incredible friendship ğŸŒŸ",
  "And all the beautiful moments we've shared âœ¨",
  "Are you ready for a little journey down memory lane? ğŸŒˆ"
];

// Quiz questions
const quizQuestions = [
  {
    question: "What's my favorite thing about Lilian?",
    options: [
      "Her beautiful smile ğŸ˜Š",
      "The way she laughs ğŸ˜„",
      "Her kind heart ğŸ’–",
      "Everything about her âœ¨"
    ],
    correct: 3
  },
  {
    question: "What would I do to make Lilian smile?",
    options: [
      "Tell a silly joke ğŸ˜†",
      "Send a sweet message ğŸ’Œ",
      "Plan a surprise ğŸ‰",
      "All of the above ğŸŒŸ"
    ],
    correct: 3
  },
  {
    question: "How do I feel when talking to Lilian?",
    options: [
      "Happy and excited ğŸ¥³",
      "Understood and valued ğŸ’«",
      "Like I'm home ğŸ¡",
      "All of these feelings ğŸ’–"
    ],
    correct: 3
  }
];

// Fortune messages
const fortunes = [
  "Today, someone (me) is thinking of you with a smile ğŸ’–",
  "Your friendship is the greatest gift in my life ğŸ",
  "Good things are coming your way, I promise! âœ¨",
  "You make the world a more beautiful place ğŸŒ¸",
  "Happiness is being your friend ğŸ˜Š",
  "You are loved more than you know ğŸ’•",
  "Magic happens when you're around âœ¨",
  "Your kindness returns to you tenfold ğŸŒŸ"
];

// Secret codes
const secretCodes = {
  "1437": "I love you forever ğŸ’–",
  "1225": "Merry Christmas my love ğŸ„",
  "0420": "You're my sunshine â˜€ï¸",
  "1008": "Perfect just as you are âœ¨",
  "9999": "Forever and always â™¾ï¸"
};

// Memory cards data
const memoryCards = [
  { title: "Our First Laugh", description: "That joke you told that made me cry laughing", emoji: "ğŸ˜„", color: "#ff9cd8" },
  { title: "Late Night Talks", description: "Those conversations that lasted until sunrise", emoji: "ğŸŒ™", color: "#9cd8ff" },
  { title: "Our Adventure Day", description: "Exploring new places together", emoji: "ğŸ—ºï¸", color: "#9cff9c" },
  { title: "Movie Nights", description: "All the films we watched together", emoji: "ğŸ¬", color: "#ff9c9c" },
  { title: "Shared Dreams", description: "Planning our future together", emoji: "ğŸ’­", color: "#d89cff" },
  { title: "Happy Tears", description: "Moments that touched our hearts", emoji: "ğŸ¥¹", color: "#ffff9c" }
];

// Toastr configuration
toastr.options = {
  "closeButton": true,
  "debug": false,
  "newestOnTop": true,
  "progressBar": true,
  "positionClass": "toast-top-right",
  "preventDuplicates": false,
  "onclick": null,
  "showDuration": "300",
  "hideDuration": "1000",
  "timeOut": "5000",
  "extendedTimeOut": "1000",
  "showEasing": "swing",
  "hideEasing": "linear",
  "showMethod": "fadeIn",
  "hideMethod": "fadeOut"
};

// ========================
// DOM ELEMENTS
// ========================
const typingEl = document.getElementById('typing');
const startBtn = document.getElementById('startBtn');
const finalMessage = document.getElementById('final');
const progressContainer = document.getElementById('progressContainer');
const progressBar = document.getElementById('progressBar');
const loveCounter = document.getElementById('loveCounter');
const loveScoreEl = document.getElementById('loveScore');
const mainContainer = document.getElementById('mainContainer');
const mainMenu = document.getElementById('mainMenu');

// ========================
// INITIALIZATION
// ========================
window.onload = function() {
  createBackgroundHearts(25);
  toastr.success("Welcome to your special surprise, Lilian! ğŸ’–", "Hello Beautiful!");
  
  // Show love counter after a delay
  setTimeout(() => {
    loveCounter.style.display = 'block';
    updateLoveScore(10);
  }, 1000);
  
  // Initialize features
  initializeMemoryAlbum();
  initializeLoveMap();
  initializeCandleRoom();
  
  // Start random love messages
  startRandomLoveMessages();
};

// ========================
// CORE FUNCTIONS
// ========================

// Typing effect
function typeMessage(index = 0, charIndex = 0) {
  if (index >= messages.length) return;
  
  if (charIndex === 0) {
    typingEl.innerHTML = '';
  }
  
  if (charIndex < messages[index].length) {
    typingEl.innerHTML += messages[index][charIndex];
    setTimeout(() => typeMessage(index, charIndex + 1), 50);
  } else {
    typingEl.innerHTML += "<br><br>";
    setTimeout(() => typeMessage(index + 1, 0), 800);
  }
}

// Start the journey
startBtn.addEventListener('click', () => {
  startBtn.style.display = 'none';
  progressContainer.style.display = 'block';
  typeMessage();
  updateProgressBar(0);
  
  // Show romantic toast messages
  setTimeout(() => {
    toastr.info("Every moment with you is magical âœ¨");
  }, 3000);
  
  setTimeout(() => {
    toastr.warning("You mean more to me than words can express ğŸ’•");
  }, 6000);
  
  setTimeout(() => {
    showQuestion(1);
  }, messages.length * 1200);
});

// Show question with animation
function showQuestion(n) {
  currentQuestion = n;
  const questionCard = document.getElementById('q' + n);
  const allQuestions = document.querySelectorAll('.question-card');
  
  allQuestions.forEach(q => {
    q.style.display = 'none';
    q.classList.remove('active');
  });
  
  questionCard.style.display = 'flex';
  setTimeout(() => {
    questionCard.classList.add('active');
  }, 50);
  
  updateProgressBar((n / totalQuestions) * 100);
  
  // Show encouraging toast
  const toastMessages = [
    "I love hearing your thoughts ğŸ’­",
    "You're doing amazing! ğŸŒŸ",
    "Your answers make me so happy! ğŸ’–",
    "I cherish every word you say âœ¨",
    "You're the best part of my day ğŸŒ¸"
  ];
  
  if (n > 1) {
    toastr.success(toastMessages[Math.floor(Math.random() * toastMessages.length)]);
  }
}

// Save answer to Firebase
function saveAnswer(question, answer) {
  db.collection('lilian_love_answers').add({
    question: question,
    answer: answer,
    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
    lovePoints: answer.length,
    feature: "main_questions"
  }).then(() => {
    updateLoveScore(answer.length);
    createHearts(5);
    waterTree(); // Water tree with each answer
    
    // Save to analytics
    db.collection('analytics').doc('answers').update({
      total: firebase.firestore.FieldValue.increment(1),
      lastAnswer: new Date()
    }).catch(() => {
      db.collection('analytics').doc('answers').set({
        total: 1,
        lastAnswer: new Date()
      });
    });
  }).catch(err => {
    console.error("Error saving answer: ", err);
    toastr.error("Couldn't save your answer, but I'll remember it in my heart ğŸ’–");
  });
}

// Next question handler
function nextQuestion(n) {
  const answerInput = document.getElementById('a' + n);
  const answer = answerInput ? answerInput.value.trim() : '';
  
  if (answerInput && answer === "") {
    toastr.warning("Please share your thoughts with me ğŸ’­");
    answerInput.focus();
    return;
  }
  
  const questionText = document.querySelector('#q' + n + ' .question-text').innerText;
  saveAnswer(questionText, answer);
  
  if (n < totalQuestions) {
    showQuestion(n + 1);
  } else {
    showFinalMessage();
  }
}

// Submit answer for button-based questions
function submitAnswer(questionNum, answer) {
  const questionText = document.querySelector('#q' + questionNum + ' .question-text').innerText;
  saveAnswer(questionText, answer);
  
  // Special effects for certain answers
  if (answer.includes('magic') || answer.includes('contagious')) {
    createLoveFireworks();
    updateLoveScore(25);
  }
  
  if (questionNum < totalQuestions) {
    showQuestion(questionNum + 1);
  } else {
    showFinalMessage();
  }
}

// Show final message
function showFinalMessage() {
  document.querySelectorAll('.question-card').forEach(q => {
    q.style.display = 'none';
  });
  
  finalMessage.style.display = 'block';
  progressContainer.style.display = 'none';
  
  // Grand finale effects
  setTimeout(() => {
    createLoveFireworks();
    createHearts(50);
    toastr.success("You've completed our love journey! ğŸ’–", "Amazing!");
    
    // Play special celebration
    confetti({
      particleCount: 150,
      spread: 100,
      origin: { y: 0.6 }
    });
    
    // Romantic message sequence
    const finalMessages = [
      "You are truly incredible ğŸ’«",
      "Thank you for being you ğŸŒ¸",
      "I cherish our friendship every day ğŸ’",
      "You make my world brighter âœ¨",
      "Forever grateful for you ğŸ’–"
    ];
    
    let i = 0;
    const messageInterval = setInterval(() => {
      if (i < finalMessages.length) {
        toastr.info(finalMessages[i]);
        i++;
      } else {
        clearInterval(messageInterval);
      }
    }, 2000);
  }, 500);
}

// Update progress bar
function updateProgressBar(percent) {
  progressBar.style.width = percent + '%';
}

// Update love score
function updateLoveScore(points) {
  loveScore += points;
  loveScoreEl.textContent = loveScore;
  loveCounter.classList.add('animate__animated', 'animate__pulse');
  setTimeout(() => {
    loveCounter.classList.remove('animate__animated', 'animate__pulse');
  }, 1000);
  
  // Special rewards at certain scores
  if (loveScore >= 200) {
    toastr.success("200 Love Points! You're amazing! ğŸŒŸ");
    createHearts(10);
  }
  if (loveScore >= 500) {
    toastr.success("500 Love Points! You're my superstar! ğŸ’«");
    createLoveFireworks();
  }
  if (loveScore >= 1000) {
    toastr.success("1000 Love Points! You're my everything! ğŸ’–");
    createLoveFireworks();
    createHearts(30);
  }
  
  // Save score to Firebase
  db.collection('lilian_scores').add({
    score: loveScore,
    pointsAdded: points,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
}

// Send hug
function sendHug() {
  updateLoveScore(50);
  createLoveFireworks();
  createHearts(20);
  
  toastr.success("ğŸ¤— Virtual hug sent with all my love! ğŸ’–", "Hug Received!");
  
  // Save hug to Firebase
  db.collection('lilian_hugs').add({
    timestamp: firebase.firestore.FieldValue.serverTimestamp(),
    message: "Virtual hug sent"
  });
  
  const hugMessages = [
    "You deserve all the hugs in the world! ğŸŒ",
    "Wish I could give you a real hug right now! ğŸ’•",
    "You're the best hugger! ğŸ¤—",
    "Sending you warmest hugs and love! ğŸ’–"
  ];
  
  setTimeout(() => {
    toastr.info(hugMessages[Math.floor(Math.random() * hugMessages.length)]);
  }, 1500);
}

// Show main menu
function showMainMenu() {
  mainContainer.style.display = 'none';
  mainMenu.style.display = 'block';
  
  // Save menu access
  db.collection('lilian_activity').add({
    action: "accessed_main_menu",
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
}

// Back to final message
function backToFinal() {
  mainMenu.style.display = 'none';
  mainContainer.style.display = 'block';
  finalMessage.style.display = 'block';
}

// ========================
// FEATURE FUNCTIONS
// ========================

// Feature navigation
function showFeature(featureId) {
  mainMenu.style.display = 'none';
  document.getElementById(featureId + 'Section').style.display = 'block';
  
  // Save feature access to Firebase
  db.collection('lilian_feature_access').add({
    feature: featureId,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
}

// Back to menu
function backToMenu() {
  document.querySelectorAll('.feature-section').forEach(section => {
    section.style.display = 'none';
  });
  mainMenu.style.display = 'block';
}

// ===== LOVE TIMELINE =====
function addMemory(memoryType) {
  const memoryText = prompt(`Tell me about this ${memoryType} memory:`);
  if (memoryText) {
    db.collection('lilian_timeline').add({
      memoryType: memoryType,
      memory: memoryText,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
    toastr.success("Memory added to our timeline! ğŸ’–");
    updateLoveScore(15);
  }
}

function saveTimelineEntry() {
  const date = document.getElementById('timelineDate').value;
  const memory = document.getElementById('timelineMemory').value;
  
  if (!date || !memory) {
    toastr.warning("Please fill in both fields!");
    return;
  }
  
  db.collection('lilian_timeline_custom').add({
    date: date,
    memory: memory,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
  
  toastr.success("Added to our timeline! ğŸ“…");
  updateLoveScore(20);
  document.getElementById('timelineDate').value = '';
  document.getElementById('timelineMemory').value = '';
}

// ===== LOVE MAP =====
function initializeLoveMap() {
  map = L.map('loveMap').setView([51.505, -0.09], 2);
  
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OpenStreetMap contributors'
  }).addTo(map);
  
  // Add some default markers for special places
  const specialPlaces = [
    { lat: 48.8566, lng: 2.3522, title: "Paris", memory: "City of Love ğŸ’–" },
    { lat: 40.7128, lng: -74.0060, title: "New York", memory: "City of Dreams ğŸŒƒ" },
    { lat: 35.6762, lng: 139.6503, title: "Tokyo", memory: "Future adventures ğŸ—¾" }
  ];
  
  specialPlaces.forEach(place => {
    L.marker([place.lat, place.lng])
      .addTo(map)
      .bindPopup(`<b>${place.title}</b><br>${place.memory}`)
      .openPopup();
  });
}

function addSpecialPlace() {
  const name = document.getElementById('placeName').value;
  const memory = document.getElementById('placeMemory').value;
  
  if (!name || !memory) {
    toastr.warning("Please fill in both fields!");
    return;
  }
  
  // Generate random coordinates (in real app, you'd use a map picker)
  const lat = 20 + Math.random() * 50;
  const lng = -100 + Math.random() * 100;
  
  db.collection('lilian_special_places').add({
    name: name,
    memory: memory,
    lat: lat,
    lng: lng,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
  
  // Add marker to map
  L.marker([lat, lng])
    .addTo(map)
    .bindPopup(`<b>${name}</b><br>${memory}`);
  
  toastr.success("Special place added to our map! ğŸ—ºï¸");
  updateLoveScore(25);
  document.getElementById('placeName').value = '';
  document.getElementById('placeMemory').value = '';
}

// ===== VIRTUAL GIFT BOX =====
function openGiftBox() {
  document.getElementById('giftContent').style.display = 'block';
  createLoveFireworks();
  toastr.success("You opened the gift box! ğŸ");
  
  db.collection('lilian_gifts').add({
    action: "opened_gift_box",
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
}

function revealGift(giftId) {
  const giftMessages = {
    1: "Our Song: 'Perfect' by Ed Sheeran ğŸµ - Because that's what you are to me",
    2: "Love Letter: You are the sunshine that brightens my darkest days. I cherish every moment with you. ğŸ’Œ",
    3: "Promise Stars: I promise to always be there for you, to make you smile, and to cherish our friendship forever. ğŸŒŸ",
    4: "Memory Jewel: Every memory with you is a precious gem I keep in my heart forever. ğŸ’",
    5: "Joy Package: May your life be filled with endless happiness, laughter, and love. ğŸ˜Š",
    6: "Forever Bond: No matter where life takes us, our friendship is unbreakable. â™¾ï¸"
  };
  
  toastr.info(giftMessages[giftId], "Your Gift ğŸ");
  updateLoveScore(15);
  
  db.collection('lilian_gifts').add({
    giftId: giftId,
    gift: giftMessages[giftId],
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
}

// ===== LOVE QUIZ =====
let currentQuizQuestion = 0;
let quizScore = 0;

function initializeQuiz() {
  const container = document.getElementById('quizContainer');
  container.innerHTML = '';
  document.getElementById('quizResult').style.display = 'none';
  currentQuizQuestion = 0;
  quizScore = 0;
  loadQuizQuestion();
}

function loadQuizQuestion() {
  const container = document.getElementById('quizContainer');
  
  if (currentQuizQuestion >= quizQuestions.length) {
    showQuizResult();
    return;
  }
  
  const question = quizQuestions[currentQuizQuestion];
  container.innerHTML = `
    <div class="quiz-question">${question.question}</div>
    <div class="quiz-options">
      ${question.options.map((option, index) => `
        <div class="quiz-option" onclick="selectQuizOption(${index})">
          ${option}
        </div>
      `).join('')}
    </div>
    <button class="btn" onclick="nextQuizQuestion()" style="margin-top: 20px;">Next â¡ï¸</button>
  `;
}

function selectQuizOption(index) {
  document.querySelectorAll('.quiz-option').forEach((opt, i) => {
    opt.classList.toggle('selected', i === index);
  });
}

function nextQuizQuestion() {
  const selected = document.querySelector('.quiz-option.selected');
  if (!selected) {
    toastr.warning("Please select an answer!");
    return;
  }
  
  const selectedIndex = Array.from(document.querySelectorAll('.quiz-option')).indexOf(selected);
  if (selectedIndex === quizQuestions[currentQuizQuestion].correct) {
    quizScore++;
    updateLoveScore(10);
  }
  
  currentQuizQuestion++;
  loadQuizQuestion();
}

function showQuizResult() {
  const container = document.getElementById('quizContainer');
  container.innerHTML = '';
  document.getElementById('quizResult').style.display = 'block';
  
  const percentage = Math.round((quizScore / quizQuestions.length) * 100);
  document.getElementById('quizScore').textContent = `Score: ${quizScore}/${quizQuestions.length} (${percentage}%)`;
  
  let message = '';
  if (percentage >= 90) {
    message = "You know me perfectly! We're soulmates! ğŸ’–";
    updateLoveScore(50);
    createLoveFireworks();
  } else if (percentage >= 70) {
    message = "You know me very well! Our connection is strong! ğŸ’•";
    updateLoveScore(30);
  } else if (percentage >= 50) {
    message = "You know me pretty well! Let's keep learning about each other! ğŸ˜Š";
    updateLoveScore(20);
  } else {
    message = "Let's spend more time getting to know each other! ğŸŒ¸";
    updateLoveScore(10);
  }
  
  document.getElementById('quizMessage').textContent = message;
  
  // Save quiz result to Firebase
  db.collection('lilian_quiz_results').add({
    score: quizScore,
    total: quizQuestions.length,
    percentage: percentage,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
}

function restartQuiz() {
  initializeQuiz();
}

// Initialize quiz when showing the section
document.getElementById('loveQuizSection').addEventListener('click', function() {
  if (this.style.display === 'block') {
    initializeQuiz();
  }
});

// ===== LOVE METER =====
function calculateCompatibility() {
  // Generate a random compatibility score (in real app, calculate based on answers)
  const compatibility = 75 + Math.floor(Math.random() * 25);
  const meterCircle = document.getElementById('meterCircle');
  const meterPercent = document.getElementById('meterPercent');
  const resultDiv = document.getElementById('compatibilityResult');
  const compatibilityText = document.getElementById('compatibilityText');
  const compatibilityDescription = document.getElementById('compatibilityDescription');
  
  // Animate meter
  let current = 0;
  const interval = setInterval(() => {
    current += 2;
    meterCircle.style.background = `conic-gradient(var(--pink) 0%, var(--light-pink) ${current}%, transparent ${current}% 100%)`;
    meterPercent.textContent = `${current}%`;
    
    if (current >= compatibility) {
      clearInterval(interval);
      meterPercent.textContent = `${compatibility}%`;
      
      // Show result
      resultDiv.style.display = 'block';
      
      if (compatibility >= 90) {
        compatibilityText.textContent = "Soulmate Level! ğŸ’«";
        compatibilityDescription.textContent = "Our connection is magical and rare. You understand me like no one else!";
        updateLoveScore(100);
        createLoveFireworks();
      } else if (compatibility >= 75) {
        compatibilityText.textContent = "Perfect Match! ğŸ’–";
        compatibilityDescription.textContent = "We complement each other perfectly. Our friendship is truly special!";
        updateLoveScore(75);
      } else {
        compatibilityText.textContent = "Great Connection! ğŸ˜Š";
        compatibilityDescription.textContent = "We have a wonderful bond that will only grow stronger with time!";
        updateLoveScore(50);
      }
      
      // Save to Firebase
      db.collection('lilian_compatibility').add({
        score: compatibility,
        result: compatibilityText.textContent,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });
    }
  }, 30);
}

// ===== PHOTO ALBUM =====
function initializeMemoryAlbum() {
  const container = document.getElementById('albumContainer');
  container.innerHTML = '';
  
  memoryCards.forEach((card, index) => {
    const cardElement = document.createElement('div');
    cardElement.className = 'memory-card';
    cardElement.style.borderColor = card.color;
    cardElement.innerHTML = `
      <div class="memory-emoji">${card.emoji}</div>
      <h3>${card.title}</h3>
      <p>${card.description}</p>
    `;
    cardElement.onclick = () => viewMemory(card);
    container.appendChild(cardElement);
  });
}

function viewMemory(card) {
  toastr.info(`<b>${card.title}</b><br>${card.description}`, card.emoji);
  updateLoveScore(5);
  
  db.collection('lilian_memory_views').add({
    memory: card.title,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
}

function addMemoryCard() {
  const title = document.getElementById('memoryTitle').value;
  const description = document.getElementById('memoryDescription').value;
  const emoji = document.getElementById('memoryEmoji').value;
  
  if (!title || !description) {
    toastr.warning("Please fill in all fields!");
    return;
  }
  
  const container = document.getElementById('albumContainer');
  const cardElement = document.createElement('div');
  cardElement.className = 'memory-card';
  cardElement.innerHTML = `
    <div class="memory-emoji">${emoji}</div>
    <h3>${title}</h3>
    <p>${description}</p>
  `;
  container.prepend(cardElement);
  
  // Save to Firebase
  db.collection('lilian_custom_memories').add({
    title: title,
    description: description,
    emoji: emoji,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
  
  toastr.success("Memory added to our album! ğŸ“¸");
  updateLoveScore(20);
  document.getElementById('memoryTitle').value = '';
  document.getElementById('memoryDescription').value = '';
}

// ===== BUCKET LIST =====
function toggleBucketItem(id) {
  const checkbox = document.getElementById(`bucket${id}`);
  const item = checkbox.parentElement;
  
  if (checkbox.checked) {
    item.classList.add('completed');
    updateLoveScore(15);
    toastr.success("One dream checked off our list! âœ¨");
    
    db.collection('lilian_bucket_list').add({
      item: item.querySelector('label').textContent,
      completed: true,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
  } else {
    item.classList.remove('completed');
  }
}

function addBucketItem() {
  const newItem = document.getElementById('newBucketItem').value;
  
  if (!newItem) {
    toastr.warning("Please enter a bucket list item!");
    return;
  }
  
  const container = document.querySelector('.bucket-list-container');
  const newId = Date.now();
  
  const itemElement = document.createElement('div');
  itemElement.className = 'bucket-item';
  itemElement.innerHTML = `
    <input type="checkbox" id="bucket${newId}" onchange="toggleBucketItem(${newId})">
    <label for="bucket${newId}">${newItem}</label>
  `;
  container.appendChild(itemElement);
  
  // Save to Firebase
  db.collection('lilian_custom_bucket_list').add({
    item: newItem,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
  
  toastr.success("Added to our bucket list! ğŸš€");
  updateLoveScore(25);
  document.getElementById('newBucketItem').value = '';
}

// ===== LOVE TREE =====
function waterTree() {
  treeLeaves++;
  
  if (treeLeaves >= 10) {
    treeLevel++;
    treeLeaves = 0;
    document.getElementById('treeLevel').textContent = treeLevel;
    createLoveFireworks();
    toastr.success(`Our love tree grew to level ${treeLevel}! ğŸŒ³`);
    
    // Add leaves to tree
    for (let i = 0; i < 5; i++) {
      addLeafToTree();
    }
  }
  
  // Save to Firebase
  db.collection('lilian_tree_growth').add({
    level: treeLevel,
    leaves: treeLeaves,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
}

function addLeafToTree() {
  const tree = document.getElementById('loveTree');
  const leaf = document.createElement('div');
  leaf.className = 'leaf';
  leaf.innerHTML = 'ğŸƒ';
  leaf.style.fontSize = (10 + Math.random() * 20) + 'px';
  leaf.style.left = (20 + Math.random() * 160) + 'px';
  leaf.style.top = (20 + Math.random() * 180) + 'px';
  tree.appendChild(leaf);
}

// ===== LOVE CODES =====
function checkCode() {
  const input = document.getElementById('codeInput').value;
  
  if (input.length === 4) {
    if (secretCodes[input]) {
      document.getElementById('codeMessage').style.display = 'block';
      document.getElementById('codeTitle').textContent = `Code: ${input}`;
      document.getElementById('codeContent').textContent = secretCodes[input];
      
      updateLoveScore(30);
      createHearts(10);
      
      // Save to Firebase
      db.collection('lilian_code_entries').add({
        code: input,
        message: secretCodes[input],
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });
    } else {
      toastr.warning("Not a valid love code. Try another! ğŸ’­");
    }
  }
}

function saveLoveCode() {
  const code = document.getElementById('newCode').value;
  const meaning = document.getElementById('codeMeaning').value;
  
  if (code.length !== 4 || !meaning) {
    toastr.warning("Please enter a 4-digit code and its meaning!");
    return;
  }
  
  secretCodes[code] = meaning;
  
  // Save to Firebase
  db.collection('lilian_custom_codes').add({
    code: code,
    meaning: meaning,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
  
  toastr.success("Your secret love code has been saved! ğŸ”");
  updateLoveScore(40);
  document.getElementById('newCode').value = '';
  document.getElementById('codeMeaning').value = '';
}

// ===== CANDLE ROOM =====
function initializeCandleRoom() {
  const room = document.getElementById('candleRoom');
  
  // Add some initial candles
  const initialCandles = [
    "Our First Meeting",
    "Shared Laughter",
    "Late Night Talks",
    "Future Dreams"
  ];
  
  initialCandles.forEach((name, index) => {
    setTimeout(() => {
      addCandleToRoom(name);
    }, index * 300);
  });
}

function addCandleToRoom(name) {
  const room = document.getElementById('candleRoom');
  const candle = document.createElement('div');
  candle.className = 'candle';
  candle.innerHTML = `
    <div class="wick"></div>
    <div class="flame"></div>
    <div class="candle-body"></div>
  `;
  candle.title = name;
  candle.onclick = () => lightCandle(candle, name);
  room.appendChild(candle);
}

function lightCandle(candle, name) {
  candle.classList.add('lit');
  toastr.info(`Candle lit for: ${name} ğŸ•¯ï¸`);
  updateLoveScore(5);
  
  // Save to Firebase
  db.collection('lilian_candles').add({
    candleName: name,
    lit: true,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
}

function addCandle() {
  const name = document.getElementById('candleName').value;
  
  if (!name) {
    toastr.warning("Please enter a name for the candle!");
    return;
  }
  
  addCandleToRoom(name);
  
  // Save to Firebase
  db.collection('lilian_custom_candles').add({
    name: name,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
  
  toastr.success("New candle added to our room! âœ¨");
  updateLoveScore(15);
  document.getElementById('candleName').value = '';
}

// ===== FORTUNE COOKIE =====
function openFortune() {
  const randomFortune = fortunes[Math.floor(Math.random() * fortunes.length)];
  const paper = document.getElementById('fortunePaper');
  
  paper.textContent = randomFortune;
  paper.style.display = 'block';
  
  // Animate
  paper.style.transform = 'scale(0)';
  setTimeout(() => {
    paper.style.transition = 'transform 0.5s';
    paper.style.transform = 'scale(1)';
  }, 10);
  
  updateLoveScore(10);
  createHearts(5);
  
  // Save to Firebase
  db.collection('lilian_fortunes').add({
    fortune: randomFortune,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });
  
  // Show fortune history
  showFortuneHistory();
}

function showFortuneHistory() {
  const historyDiv = document.getElementById('fortuneHistory');
  const listDiv = document.getElementById('fortuneList');
  
  // In a real app, you would fetch from Firebase
  // For now, just show current fortune
  listDiv.innerHTML = `<p>${document.getElementById('fortunePaper').textContent}</p>`;
  historyDiv.style.display = 'block';
}

// ===== TIME CAPSULE =====
function sealTimeCapsule() {
  const toFutureLilian = document.getElementById('toFutureLilian').value;
  const toFutureUs = document.getElementById('toFutureUs').value;
  const futurePredictions = document.getElementById('futurePredictions').value;
  
  if (!toFutureLilian || !toFutureUs || !futurePredictions) {
    toastr.warning("Please fill in all time capsule fields!");
    return;
  }
  
  const openDate = new Date();
  openDate.setFullYear(openDate.getFullYear() + 1);
  
  // Save to Firebase
  db.collection('lilian_time_capsule').add({
    toFutureLilian: toFutureLilian,
    toFutureUs: toFutureUs,
    futurePredictions: futurePredictions,
    openDate: openDate,
    created: firebase.firestore.FieldValue.serverTimestamp()
  });
  
  // Show success message
  document.getElementById('capsuleSealed').style.display = 'block';
  document.getElementById('capsuleDate').textContent = openDate.toLocaleDateString();
  
  toastr.success("Time capsule sealed! We'll open it together in one year! ğŸ“…");
  updateLoveScore(100);
  createLoveFireworks();
}

// ========================
// VISUAL EFFECTS
// ========================

// Create floating hearts
function createHearts(count) {
  for (let i = 0; i < count; i++) {
    setTimeout(() => {
      const heart = document.createElement('div');
      heart.className = 'heart';
      heart.style.left = Math.random() * 100 + '%';
      heart.style.animationDuration = (3 + Math.random() * 4) + 's';
      heart.style.fontSize = (20 + Math.random() * 30) + 'px';
      heart.innerHTML = Math.random() > 0.5 ? 'ğŸ’–' : 'ğŸ’•';
      document.body.appendChild(heart);
      
      setTimeout(() => {
        heart.remove();
      }, 6000);
    }, i * 100);
  }
}

// Create background hearts
function createBackgroundHearts(count) {
  const container = document.getElementById('backgroundHearts');
  for (let i = 0; i < count; i++) {
    const heart = document.createElement('div');
    heart.className = 'heart';
    heart.style.left = Math.random() * 100 + '%';
    heart.style.animationDuration = (8 + Math.random() * 10) + 's';
    heart.style.animationDelay = Math.random() * 5 + 's';
    heart.style.fontSize = (15 + Math.random() * 25) + 'px';
    heart.innerHTML = Math.random() > 0.5 ? 'ğŸ’–' : 'ğŸ’•';
    container.appendChild(heart);
  }
}

// Create love fireworks
function createLoveFireworks() {
  confetti({
    particleCount: 100,
    angle: 60,
    spread: 55,
    origin: { x: 0 },
    colors: ['#ff61a6', '#ff9cd8', '#ff9cee', '#ffffff']
  });
  
  confetti({
    particleCount: 100,
    angle: 120,
    spread: 55,
    origin: { x: 1 },
    colors: ['#ff61a6', '#ff9cd8', '#ff9cee', '#ffffff']
  });
  
  // Add heart-shaped confetti
  setTimeout(() => {
    confetti({
      particleCount: 30,
      spread: 70,
      origin: { y: 0.6 },
      shapes: ['heart'],
      colors: ['#ff61a6']
    });
  }, 300);
}

// Toggle background music
function toggleMusic() {
  const musicBtn = document.getElementById('musicBtn');
  
  if (musicPlaying) {
    backgroundMusic.pause();
    musicBtn.innerHTML = '<i class="fas fa-music"></i>';
    toastr.info("Music paused â¸ï¸");
  } else {
    backgroundMusic.play().catch(e => {
      toastr.warning("Click anywhere to enable music ğŸµ");
      document.body.addEventListener('click', () => {
        backgroundMusic.play();
        musicPlaying = true;
        musicBtn.innerHTML = '<i class="fas fa-pause"></i>';
        toastr.success("Romantic music playing ğŸ¶");
      }, { once: true });
    });
    musicBtn.innerHTML = '<i class="fas fa-pause"></i>';
    toastr.success("Playing our special song ğŸµ");
  }
  
  musicPlaying = !musicPlaying;
}

// Show hidden love messages
function showHiddenMessage(id) {
  const message = document.getElementById('hiddenMessage' + id);
  message.style.display = 'block';
  updateLoveScore(15);
  
  setTimeout(() => {
    message.style.display = 'none';
  }, 3000);
}

// Random love messages
function startRandomLoveMessages() {
  setInterval(() => {
    if (Math.random() > 0.7) { // 30% chance
      const loveNotes = [
        "Just thinking about you ğŸ’­",
        "You're amazing! âœ¨",
        "Sending you virtual hugs! ğŸ¤—",
        "Our friendship is my favorite thing ğŸ’–",
        "You make my world brighter ğŸŒŸ",
        "I'm so grateful for you ğŸ™",
        "You're one in a million! ğŸ’«",
        "Hope you're having a wonderful day! ğŸŒ¸"
      ];
      
      toastr.info(loveNotes[Math.floor(Math.random() * loveNotes.length)]);
    }
  }, 300000); // Every 5 minutes
}

// Easter egg: Secret code for extra love
const konamiCode = [
  'ArrowUp', 'ArrowUp', 
  'ArrowDown', 'ArrowDown',
  'ArrowLeft', 'ArrowRight',
  'ArrowLeft', 'ArrowRight',
  'b', 'a'
];
let konamiInput = [];

document.addEventListener('keydown', (e) => {
  konamiInput.push(e.key);
  konamiInput.splice(-konamiCode.length - 1, konamiInput.length - konamiCode.length);
  
  if (konamiInput.join('') === konamiCode.join('')) {
    toastr.success("ğŸ‰ Secret Konami code activated! ğŸ‰", "You found the ultimate love code!");
    updateLoveScore(1000);
    createLoveFireworks();
    createHearts(100);
    konamiInput = [];
    
    // Save to Firebase
    db.collection('lilian_easter_eggs').add({
      egg: "konami_code",
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
  }
});

// ========================
// ANALYTICS AND TRACKING
// ========================

// Track page views
db.collection('analytics').doc('page_views').update({
  count: firebase.firestore.FieldValue.increment(1),
  lastView: new Date()
}).catch(() => {
  db.collection('analytics').doc('page_views').set({
    count: 1,
    lastView: new Date()
  });
});

// Track feature usage
document.querySelectorAll('.menu-item').forEach(item => {
  item.addEventListener('click', function() {
    const featureName = this.querySelector('h3').textContent;
    db.collection('lilian_feature_usage').add({
      feature: featureName,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
  });
});

// Track time spent
let startTime = new Date();
setInterval(() => {
  const timeSpent = Math.floor((new Date() - startTime) / 1000);
  if (timeSpent % 60 === 0) { // Every minute
    db.collection('lilian_time_tracking').add({
      seconds: timeSpent,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
  }
}, 1000);
</script>
</body>
</html>
